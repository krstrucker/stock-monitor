# 7000개 전체 종목 스캔 가이드

## 설정 방법

### Heroku 환경 변수 설정

```powershell
# 전체 종목 스캔 설정
heroku config:set MONITOR_SYMBOL_COUNT=7000 --app your-stock-monitor

# 필터링 방법 선택 (선택사항)
heroku config:set FILTER_METHOD=index_priority --app your-stock-monitor
# 또는
heroku config:set FILTER_METHOD=market_cap --app your-stock-monitor
# 또는
heroku config:set FILTER_METHOD=none --app your-stock-monitor

# 스레드 수 증가 (더 빠르게)
heroku config:set MONITOR_WORKERS=30 --app your-stock-monitor

# 스캔 간격 조정 (더 긴 간격 권장)
heroku config:set MONITOR_INTERVAL=120 --app your-stock-monitor
```

## 예상 소요 시간

- **7000개 종목**: 약 20-30분
- **멀티스레딩 (30개 스레드)**: 약 10-15분
- **멀티스레딩 (20개 스레드)**: 약 15-20분

## 주의사항

### 1. Heroku 무료 티어 제한
- **30분 타임아웃**: 요청이 30분 이상 걸리면 타임아웃될 수 있음
- **메모리 제한**: 512MB 제한
- **슬립 모드**: 30분 동안 활동이 없으면 슬립 모드로 전환

### 2. API 호출 제한
- **yfinance 제한**: 너무 많은 요청 시 일시적으로 차단될 수 있음
- **해결책**: 스레드 수를 조절하거나 재시도 로직 사용

### 3. 실행 시간
- **초기 스캔**: 매우 오래 걸릴 수 있음 (20-30분)
- **주기적 스캔**: 설정한 간격마다 실행 (예: 2시간마다)

## 권장 설정

### 안정적인 설정
```powershell
heroku config:set MONITOR_SYMBOL_COUNT=7000 --app your-stock-monitor
heroku config:set MONITOR_WORKERS=20 --app your-stock-monitor
heroku config:set MONITOR_INTERVAL=120 --app your-stock-monitor
heroku config:set FILTER_METHOD=index_priority --app your-stock-monitor
```

### 빠른 설정 (위험할 수 있음)
```powershell
heroku config:set MONITOR_SYMBOL_COUNT=7000 --app your-stock-monitor
heroku config:set MONITOR_WORKERS=50 --app your-stock-monitor
heroku config:set MONITOR_INTERVAL=60 --app your-stock-monitor
```

## 문제 해결

### 타임아웃 발생 시
1. 스레드 수 줄이기: `MONITOR_WORKERS=15`
2. 스캔 간격 늘리기: `MONITOR_INTERVAL=180`
3. 종목 수 줄이기: `MONITOR_SYMBOL_COUNT=5000`

### API 제한 발생 시
1. 스레드 수 줄이기
2. 재시도 로직이 자동으로 작동함
3. 잠시 후 다시 시도

### 메모리 부족 시
1. 스레드 수 줄이기
2. 종목 수 줄이기

## 모니터링

### 로그 확인
```powershell
heroku logs --tail --app your-stock-monitor
```

### 상태 확인
- 웹 인터페이스: https://your-stock-monitor-813996068d17.herokuapp.com/status
- API: https://your-stock-monitor-813996068d17.herokuapp.com/status

## 완료!

설정 후 서버가 자동으로 재시작되며, 다음 스캔부터 7000개 전체 종목을 스캔합니다!

