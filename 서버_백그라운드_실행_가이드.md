# 서버 백그라운드 실행 가이드

## ⚠️ 중요: 터미널을 닫으면 서버가 종료됩니다!

현재 방식으로 실행하면:
- ❌ 터미널을 닫으면 서버가 종료됨
- ❌ 컴퓨터를 재시작하면 서버가 종료됨

## 해결 방법

### 방법 1: 별도 창에서 실행 (가장 간단)

#### 배치 파일 사용
1. `start_server_background.bat` 파일 열기
2. 파일 안의 값 수정:
   ```batch
   set TELEGRAM_BOT_TOKEN=실제_봇_토큰
   set TELEGRAM_CHAT_ID=실제_채팅_ID
   ```
3. 파일 저장 후 더블클릭으로 실행
4. 새 창이 열리면서 서버가 실행됨
5. **원래 터미널은 닫아도 됨** (새 창은 열어둠)

#### 수동으로 실행
PowerShell에서:
```powershell
# 새 PowerShell 창에서 실행
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd 'C:\Users\용\Desktop\us stock auto'; `$env:TELEGRAM_BOT_TOKEN='your_token'; `$env:TELEGRAM_CHAT_ID='your_chat_id'; python server.py"
```

### 방법 2: 작업 스케줄러로 등록 (24시간 자동 실행)

1. **작업 스케줄러 열기**
   - Win + R → `taskschd.msc` 입력

2. **기본 작업 만들기**
   - 오른쪽 "기본 작업 만들기" 클릭
   - 이름: "주식 신호 모니터링 서버"
   - 설명: "주식 매수 신호 모니터링 및 텔레그램 알림"

3. **트리거 설정**
   - "컴퓨터 시작 시" 선택

4. **동작 설정**
   - "프로그램 시작" 선택
   - 프로그램/스크립트: `python.exe`의 전체 경로
     - 예: `C:\Users\용\AppData\Local\Programs\Python\Python311\python.exe`
   - 인수 추가: `server.py`의 전체 경로
     - 예: `C:\Users\용\Desktop\us stock auto\server.py`
   - 시작 위치: `C:\Users\용\Desktop\us stock auto`

5. **환경 변수 설정**
   - "조건" 탭에서 "전원" 설정 확인
   - "설정" 탭에서 "작업이 요청되지 않아도 실행" 체크

6. **환경 변수 추가 (중요!)**
   - 작업 속성 → "일반" 탭 → "사용자 로그온 여부와 관계없이 실행" 선택
   - "동작" 탭 → "시작" 편집
   - "인수 추가" 옆에 환경 변수 추가:
     ```
     -c "import os; os.environ['TELEGRAM_BOT_TOKEN']='your_token'; os.environ['TELEGRAM_CHAT_ID']='your_chat_id'; exec(open('server.py').read())"
     ```

   또는 더 간단하게:
   - 배치 파일 생성 (`start_server_task.bat`):
     ```batch
     @echo off
     set TELEGRAM_BOT_TOKEN=your_token
     set TELEGRAM_CHAT_ID=your_chat_id
     set MONITOR_INTERVAL=60
     set MONITOR_SYMBOL_COUNT=100
     cd /d "C:\Users\용\Desktop\us stock auto"
     python server.py
     ```
   - 작업 스케줄러에서 이 배치 파일을 실행하도록 설정

### 방법 3: NSSM으로 Windows 서비스로 등록 (고급)

1. **NSSM 다운로드**
   - https://nssm.cc/download
   - 압축 해제

2. **서비스 등록**
   ```cmd
   nssm install StockMonitor
   ```
   - Path: `python.exe`의 전체 경로
   - Startup directory: `C:\Users\용\Desktop\us stock auto`
   - Arguments: `server.py`
   - Environment: 
     ```
     TELEGRAM_BOT_TOKEN=your_token
     TELEGRAM_CHAT_ID=your_chat_id
     MONITOR_INTERVAL=60
     MONITOR_SYMBOL_COUNT=100
     ```

3. **서비스 시작**
   ```cmd
   nssm start StockMonitor
   ```

## 추천 방법

### 개발/테스트 중
- **방법 1 (별도 창)**: 가장 간단하고 빠름

### 24시간 자동 실행
- **방법 2 (작업 스케줄러)**: Windows 기본 기능 사용
- **방법 3 (NSSM 서비스)**: 더 전문적이지만 설정 복잡

## 확인 방법

서버가 실행 중인지 확인:
1. 브라우저에서 http://localhost:5000 접속
2. 서버 상태 확인
3. 텔레그램으로 테스트 메시지 전송

## 서버 중지 방법

### 별도 창에서 실행한 경우
- 서버 창을 닫으면 됨

### 작업 스케줄러로 등록한 경우
- 작업 스케줄러에서 작업 비활성화 또는 삭제

### NSSM 서비스로 등록한 경우
```cmd
nssm stop StockMonitor
nssm remove StockMonitor
```

