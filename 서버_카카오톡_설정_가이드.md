# 서버에서 카카오톡 알림 받는 방법

## 📋 전체 과정 요약

1. **카카오톡 API 키 발급** (또는 텔레그램 봇 생성)
2. **환경 변수 설정**
3. **서버 실행**
4. **자동 모니터링 시작**

---

## 방법 1: 카카오톡 알림톡 API (공식, 유료)

### ⚠️ 주의사항
- 카카오 비즈니스 계정 필요 (유료)
- 알림톡 템플릿 승인 필요
- 설정이 복잡함

### 단계별 가이드

#### 1단계: 카카오 개발자 센터 접속
1. https://developers.kakao.com 접속
2. 카카오 계정으로 로그인

#### 2단계: 애플리케이션 생성
1. **내 애플리케이션** 클릭
2. **애플리케이션 추가하기** 클릭
3. 앱 이름: "주식 신호 알림" (원하는 이름)
4. 사업자명: 본인 이름 또는 회사명
5. **저장** 클릭

#### 3단계: API 키 확인
1. 생성한 애플리케이션 클릭
2. **앱 설정** > **앱 키** 메뉴
3. **REST API 키** 복사
4. **Admin 키** 복사 (중요!)

#### 4단계: 카카오 비즈니스 계정 신청
1. https://business.kakao.com 접속
2. 카카오 비즈니스 계정 신청 (유료 서비스)
3. 알림톡 서비스 활성화

#### 5단계: 알림톡 템플릿 생성
1. 카카오 비즈니스 콘솔 접속
2. **알림톡** > **템플릿 관리**
3. 새 템플릿 생성
4. 템플릿 내용 작성
5. 템플릿 승인 대기
6. **템플릿 ID** 복사

#### 6단계: 환경 변수 설정

**Windows PowerShell:**
```powershell
$env:KAKAO_REST_API_KEY = "여기에_REST_API_키_붙여넣기"
$env:KAKAO_ADMIN_KEY = "여기에_Admin_키_붙여넣기"
$env:KAKAO_TEMPLATE_ID = "여기에_템플릿_ID_붙여넣기"
$env:MONITOR_INTERVAL = "60"
$env:MONITOR_SYMBOL_COUNT = "100"
```

#### 7단계: 서버 실행
```bash
python server.py
```

---

## 방법 2: 텔레그램 봇 (추천! 더 간단하고 무료)

카카오톡 설정이 복잡하므로, **텔레그램 봇을 강력히 추천**합니다!

### 단계별 가이드 (5분이면 완료!)

#### 1단계: 텔레그램 봇 생성
1. 텔레그램 앱 열기
2. 검색창에 **@BotFather** 입력
3. 봇과 대화 시작
4. `/newbot` 명령 전송
5. 봇 이름 입력: "내 주식 신호 봇"
6. 봇 사용자명 입력: "my_stock_signal_bot" (영문, 숫자, 언더스코어만)
7. **봇 토큰 받기** (예: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)
8. **봇 토큰 복사해두기** ⚠️ 중요!

#### 2단계: 채팅 ID 확인
1. 텔레그램에서 **@userinfobot** 검색
2. 봇과 대화 시작
3. `/start` 명령 전송
4. **채팅 ID 확인** (예: `123456789`)
5. **채팅 ID 복사해두기** ⚠️ 중요!

#### 3단계: 봇과 대화 시작
1. 생성한 봇 검색 (예: @my_stock_signal_bot)
2. 봇과 대화 시작
3. `/start` 명령 전송
4. 이제 봇이 메시지를 받을 수 있습니다!

#### 4단계: 환경 변수 설정

**Windows PowerShell:**
```powershell
# 텔레그램 봇 토큰 설정
$env:TELEGRAM_BOT_TOKEN = "여기에_봇_토큰_붙여넣기"

# 채팅 ID 설정
$env:TELEGRAM_CHAT_ID = "여기에_채팅_ID_붙여넣기"

# 모니터링 설정
$env:MONITOR_INTERVAL = "60"  # 60분마다 스캔
$env:MONITOR_SYMBOL_COUNT = "100"  # 100개 종목 모니터링
$env:MONITOR_WORKERS = "20"  # 20개 스레드 사용
```

**Linux/Mac:**
```bash
export TELEGRAM_BOT_TOKEN="여기에_봇_토큰_붙여넣기"
export TELEGRAM_CHAT_ID="여기에_채팅_ID_붙여넣기"
export MONITOR_INTERVAL=60
export MONITOR_SYMBOL_COUNT=100
export MONITOR_WORKERS=20
```

#### 5단계: 서버 실행
```bash
python server.py
```

---

## 서버 실행 방법

### 방법 1: 배치 파일 사용 (Windows, 가장 간단)

1. `start_server.bat` 파일 열기
2. 파일 안의 값들을 실제 값으로 수정:
   ```batch
   set TELEGRAM_BOT_TOKEN=실제_봇_토큰
   set TELEGRAM_CHAT_ID=실제_채팅_ID
   ```
3. 파일 더블클릭으로 실행

### 방법 2: PowerShell에서 직접 실행

```powershell
# 환경 변수 설정
$env:TELEGRAM_BOT_TOKEN = "your_bot_token"
$env:TELEGRAM_CHAT_ID = "your_chat_id"
$env:MONITOR_INTERVAL = "60"
$env:MONITOR_SYMBOL_COUNT = "100"

# 서버 실행
python server.py
```

### 방법 3: 백그라운드 실행 (Windows)

```powershell
# 새 PowerShell 창에서 실행
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd 'C:\Users\용\Desktop\us stock auto'; `$env:TELEGRAM_BOT_TOKEN='your_token'; `$env:TELEGRAM_CHAT_ID='your_chat_id'; python server.py"
```

---

## 서버 배포 (24시간 실행)

### 로컬 서버 (Windows)

#### 방법 1: 작업 스케줄러 사용
1. 작업 스케줄러 열기 (Win + R → `taskschd.msc`)
2. 기본 작업 만들기
3. 트리거: 컴퓨터 시작 시
4. 동작: 프로그램 시작
5. 프로그램: `python.exe`
6. 인수: `C:\Users\용\Desktop\us stock auto\server.py`
7. 시작 위치: `C:\Users\용\Desktop\us stock auto`

#### 방법 2: 서비스로 등록 (고급)
- NSSM (Non-Sucking Service Manager) 사용

### 클라우드 서버 (Heroku - 무료)

```bash
# 1. Heroku CLI 설치
# https://devcenter.heroku.com/articles/heroku-cli

# 2. 로그인
heroku login

# 3. 앱 생성
heroku create your-app-name

# 4. 환경 변수 설정
heroku config:set TELEGRAM_BOT_TOKEN=your_token
heroku config:set TELEGRAM_CHAT_ID=your_chat_id
heroku config:set MONITOR_INTERVAL=60
heroku config:set MONITOR_SYMBOL_COUNT=100

# 5. 배포
git init
git add .
git commit -m "Initial commit"
git push heroku main

# 6. 로그 확인
heroku logs --tail
```

### Linux 서버 (VPS, AWS 등)

```bash
# 1. 서버 접속
ssh user@your-server-ip

# 2. 프로젝트 업로드
scp -r . user@server:/path/to/us-stock-auto

# 3. systemd 서비스 생성
sudo nano /etc/systemd/system/stock-monitor.service
```

서비스 파일 내용:
```ini
[Unit]
Description=Stock Signal Monitor
After=network.target

[Service]
Type=simple
User=your-user
WorkingDirectory=/path/to/us-stock-auto
Environment="TELEGRAM_BOT_TOKEN=your_token"
Environment="TELEGRAM_CHAT_ID=your_chat_id"
Environment="MONITOR_INTERVAL=60"
Environment="MONITOR_SYMBOL_COUNT=100"
ExecStart=/usr/bin/python3 /path/to/us-stock-auto/server.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
# 4. 서비스 시작
sudo systemctl daemon-reload
sudo systemctl enable stock-monitor
sudo systemctl start stock-monitor

# 5. 상태 확인
sudo systemctl status stock-monitor

# 6. 로그 확인
sudo journalctl -u stock-monitor -f
```

---

## 테스트 방법

### 1. 알림 테스트
```python
from kakao_notifier import TelegramNotifier

notifier = TelegramNotifier()
notifier.send_message("테스트 메시지입니다! 🎉")
```

### 2. 서버 상태 확인
브라우저에서 접속:
- http://localhost:5000/status

### 3. 즉시 스캔 실행
브라우저에서 접속:
- http://localhost:5000/scan

---

## 완료 확인

서버가 정상적으로 실행되면:

1. ✅ 콘솔에 "✅ 스케줄러 시작됨" 메시지 표시
2. ✅ 초기 스캔 자동 실행
3. ✅ 웹 인터페이스 접속 가능 (http://localhost:5000)
4. ✅ 설정한 간격마다 자동 스캔
5. ✅ 새로운 신호 발견 시 텔레그램/카카오톡으로 알림

---

## 문제 해결

### 알림이 안 오는 경우
1. **봇 토큰 확인**: @BotFather에서 `/token` 명령
2. **채팅 ID 확인**: @userinfobot에서 다시 확인
3. **봇과 대화 시작**: 봇에게 `/start` 명령 전송 필수!
4. **환경 변수 확인**: `echo $env:TELEGRAM_BOT_TOKEN` (PowerShell)

### 서버가 실행되지 않는 경우
1. **포트 확인**: 5000번 포트가 사용 중인지 확인
2. **포트 변경**: `$env:PORT = "5001"`
3. **로그 확인**: 오류 메시지 확인

### 서버가 자동으로 재시작되지 않는 경우
1. **systemd 확인**: `sudo systemctl status stock-monitor`
2. **로그 확인**: `sudo journalctl -u stock-monitor -n 50`

---

## 추천 설정

### 개발/테스트
```powershell
$env:MONITOR_INTERVAL = "10"  # 10분마다 (빠른 테스트)
$env:MONITOR_SYMBOL_COUNT = "50"  # 50개 종목만
```

### 프로덕션
```powershell
$env:MONITOR_INTERVAL = "60"  # 1시간마다
$env:MONITOR_SYMBOL_COUNT = "200"  # 200개 종목
$env:MONITOR_WORKERS = "30"  # 더 많은 스레드
```

---

## 완료! 🎉

이제 서버가 백그라운드에서:
- ✅ 자동으로 주기적 스캔
- ✅ 새로운 매수 신호 발견 시 카카오톡/텔레그램 알림
- ✅ 24시간 자동 실행
- ✅ 웹 인터페이스로 상태 확인

